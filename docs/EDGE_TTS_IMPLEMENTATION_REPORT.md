# ๐ ุชูุฑูุฑ ููุตู: ุชูููุฐ ูุธุงู Edge-TTS ููุฑูุจูุช ุงูุฌุงูุนู

## ๐ ูุธุฑุฉ ุนุงูุฉ ุนูู ุงููุดุฑูุน

**ุงุณู ุงููุดุฑูุน**: ุฑูุจูุช ุฌุงูุนู ุชููู ุชูุงุนูู  
**ุงูุชุงุฑูุฎ**: 2025-02-02  
**ุงููุฏู**: ุงุณุชุจุฏุงู Web Speech Synthesis API ุจูุธุงู Edge-TTS ูุฏุนู ุงููุทู ุจุงููุบุฉ ุงูุนุฑุจูุฉ

---

## ๐ฏ ุงููุดููุฉ ุงูุฃุตููุฉ

### ุงููุถุน ูุจู ุงูุชุนุฏูู:
- โ Web Speech Synthesis API ูุง ูุฏุนู ุงูุนุฑุจูุฉ ุนูู Windows
- โ ูุง ุชูุฌุฏ ุฃุตูุงุช ุนุฑุจูุฉ ูุซุจุชุฉ ุนูู ุงููุธุงู
- โ ุงูุตูุช ุงูุฅูุฌููุฒู ูุง ูุณุชุทูุน ูุทู ุงูุนุฑุจูุฉ
- โ ุงููุชูุฌุฉ: ุตูุช ุชุงู ุนูุฏ ูุญุงููุฉ ุงููุทู

### ุงูุญู ุงููุทููุจ:
ุงุณุชุจุฏุงู Web Speech Synthesis ุจู **Edge-TTS** (Python) ูุฃูู:
- โ ูุฌุงูู 100%
- โ ุฌูุฏุฉ ุตูุช ุนุงููุฉ ุฌุฏุงู
- โ ูุฏุนู ุงูุนุฑุจูุฉ ุจุดูู ููุชุงุฒ
- โ ูุง ูุญุชุงุฌ ุชุซุจูุช ุฃุตูุงุช ุนูู ุงููุธุงู
- โ ูุง ูุญุชุงุฌ API Key

---

## ๐ ูููู ุงููุดุฑูุน ุจุนุฏ ุงูุชุนุฏูู

```
bot_it/
โโโ backend/
โ   โโโ server.js                 # Node.js WebSocket Server (ูู ูุชุบูุฑ)
โ   โโโ config.js                 # ุงูุฅุนุฏุงุฏุงุช (ูู ูุชุบูุฑ)
โ   โโโ gemini-text-handler.js    # Vertex AI (ูู ูุชุบูุฑ)
โ   โโโ tts-server.py             # โจ ุฌุฏูุฏ: Python TTS Server
โ
โโโ frontend/
โ   โโโ index.html                # ูุงุฌูุฉ ุงููุณุชุฎุฏู (ูู ูุชุบูุฑ)
โ   โโโ app.js                    # โจ ูุนุฏูู: ูุณุชุฏุนู TTS ูู Python
โ   โโโ styles.css                # ุงูุชูุณููุงุช (ูู ูุชุบูุฑ)
โ
โโโ requirements.txt              # โจ ุฌุฏูุฏ: ูุชุทูุจุงุช Python
โโโ start.bat                     # โจ ุฌุฏูุฏ: ุชุดุบูู ุงูุฎุงุฏููู ูุนุงู
โโโ .env                          # ูุชุบูุฑุงุช ุงูุจูุฆุฉ (ูู ูุชุบูุฑ)
โโโ package.json                  # ูุชุทูุจุงุช Node.js (ูู ูุชุบูุฑ)
```

---

## ๐ง ุงูุฅุฌุฑุงุกุงุช ุงููููุฐุฉ

### 1๏ธโฃ ุฅูุดุงุก ููู [`requirements.txt`](bot_it/requirements.txt:1)

**ุงููุญุชูู:**
```txt
edge-tts==6.1.9
aiohttp==3.9.1
aiofiles==23.2.1
```

**ุงููุตู:**
- `edge-tts`: ููุชุจุฉ Microsoft Edge TTS ูููุทู
- `aiohttp`: ุฎุงุฏู ููุจ ุบูุฑ ูุชุฒุงูู
- `aiofiles`: ุงูุชุนุงูู ูุน ุงููููุงุช ุจุดูู ุบูุฑ ูุชุฒุงูู

---

### 2๏ธโฃ ุฅูุดุงุก ููู [`backend/tts-server.py`](bot_it/backend/tts-server.py:1)

**ุงููุตู:** ุฎุงุฏู Python ูููุฑ API ูุชุญููู ุงููุต ุงูุนุฑุจู ุฅูู ุตูุช MP3

**ุงูููููุงุช ุงูุฑุฆูุณูุฉ:**

#### ุฃ) ูุงุฆูุฉ ุงูุฃุตูุงุช ุงูุนุฑุจูุฉ (10 ุฃุตูุงุช):
```python
ARABIC_VOICES = {
    'ar-SA-HamedNeural': 'ุณุนูุฏู - ุญุงูุฏ (ุฐูุฑ)',
    'ar-SA-ZariyahNeural': 'ุณุนูุฏู - ุฒุงุฑูุฉ (ุฃูุซู)',
    'ar-EG-SalmaNeural': 'ูุตุฑู - ุณููู (ุฃูุซู)',
    'ar-EG-ShakirNeural': 'ูุตุฑู - ุดุงูุฑ (ุฐูุฑ)',
    'ar-AE-FatimaNeural': 'ุฅูุงุฑุงุชู - ูุงุทูุฉ (ุฃูุซู)',
    'ar-AE-HamdanNeural': 'ุฅูุงุฑุงุชู - ุญูุฏุงู (ุฐูุฑ)',
    'ar-KW-FahedNeural': 'ูููุชู - ููุฏ (ุฐูุฑ)',
    'ar-KW-NouraNeural': 'ูููุชู - ููุฑุฉ (ุฃูุซู)',
    'ar-QA-AmalNeural': 'ูุทุฑู - ุฃูู (ุฃูุซู)',
    'ar-QA-MoazNeural': 'ูุทุฑู - ูุนุงุฐ (ุฐูุฑ)',
}
```

#### ุจ) ุฏูุงู TTS ุงูุฃุณุงุณูุฉ:
1. **`text_to_speech(text, voice)`** - ุชุญููู ุงููุต ุฅูู ุตูุช MP3 (bytes)
2. **`text_to_speech_base64(text, vQoice)`** - ุชุญููู ุงููุต ุฅูู ุตูุช Base64

#### ุฌ) API Endpoints:
| Endpoint | ุงูุทุฑููุฉ | ุงููุธููุฉ |
|----------|---------|---------|
| `/health` | GET | ูุญุต ุญุงูุฉ ุงูุฎุงุฏู |
| `/voices` | GET | ูุงุฆูุฉ ุงูุฃุตูุงุช ุงููุชุงุญุฉ |
| `/synthesize` | POST | ุชุญููู ูุต ุฅูู ุตูุช (Base64) |
| `/synthesize/stream` | POST | ุชุญููู ูุต ุฅูู ุตูุช (Stream) |

#### ุฏ) ูุซุงู ุทูุจ API:
```bash
POST http://localhost:5000/synthesize
Content-Type: application/json

{
    "text": "ูุฑุญุจุงูุ ููู ุญุงููุ",
    "voice": "ar-SA-HamedNeural"
}
```

**ุงูุงุณุชุฌุงุจุฉ:**
```json
{
    "success": true,
    "audio": "base64_encoded_mp3_data...",
    "format": "mp3",
    "voice": "ar-SA-HamedNeural"
}
```

---

### 3๏ธโฃ ุชุนุฏูู ููู [`frontend/app.js`](bot_it/frontend/app.js:1)

#### ุงูุฃูุณุงู ุงููุญุฐููุฉ:
1. **ูุธุงู Web Speech Synthesis ุงููุฏูู** (ุงูุฃุณุทุฑ 120-305):
   - `loadVoices()` - ุชุญููู ุฃุตูุงุช ุงููุชุตูุญ
   - `findBestArabicVoice()` - ุงูุจุญุซ ุนู ุตูุช ุนุฑุจู
   - `speakText()` - ุงููุทู ุจุงุณุชุฎุฏุงู speechSynthesis
   - `speakWithFallback()` - ุงูุญู ุงูุจุฏูู
   - `speakSentence()` - ูุทู ุฌููุฉ ูุงุญุฏุฉ

2. **ูุธุงู Streaming TTS ุงููุฏูู** (ุงูุฃุณุทุฑ 307-478):
   - `enqueueUtterance()` - ุฅุถุงูุฉ utterance ูููุงุฆูุฉ
   - `playNext()` - ุชุดุบูู ุงูุชุงูู
   - ุงุณุชุฎุฏู `SpeechSynthesisUtterance`

#### ุงูุฃูุณุงู ุงูุฌุฏูุฏุฉ:

**ุฃ) ุฅุนุฏุงุฏุงุช Edge-TTS:**
```javascript
const TTS_SERVER = 'http://localhost:5000';
const ARABIC_VOICES = { /* 10 ุฃุตูุงุช */ };
let currentVoice = 'ar-SA-HamedNeural';
let speechQueue = [];
let isSpeaking = false;
```

**ุจ) ุงูุฏูุงู ุงูุฌุฏูุฏุฉ:**

| ุงูุฏุงูุฉ | ุงููุธููุฉ |
|--------|---------|
| [`speakText(text, voice)`](bot_it/frontend/app.js:138) | ุฅุถุงูุฉ ูุต ููุงุฆูุฉ ุงูุงูุชุธุงุฑ |
| [`processQueue()`](bot_it/frontend/app.js:150) | ูุนุงูุฌุฉ ูุงุฆูุฉ ุงูุงูุชุธุงุฑ |
| [`playAudioBase64(base64Audio)`](bot_it/frontend/app.js:193) | ุชุดุบูู ุตูุช ูู Base64 |
| [`stopSpeaking()`](bot_it/frontend/app.js:210) | ุฅููุงู ุงููุทู |
| [`setVoice(voice)`](bot_it/frontend/app.js:219) | ุชุบููุฑ ุงูุตูุช |
| [`getAvailableVoices()`](bot_it/frontend/app.js:228) | ุฌูุจ ุงูุฃุตูุงุช ูู ุงูุฎุงุฏู |
| [`checkTTSServer()`](bot_it/frontend/app.js:239) | ูุญุต ุญุงูุฉ ุงูุฎุงุฏู |

**ุฌ) ุชุญุฏูุซ Streaming TTS:**
- `enqueueUtterance()` - ุงูุขู ุชุณุชุฎุฏู Edge-TTS ุจุฏูุงู ูู SpeechSynthesis
- `consumeDelta()` - ูู ุชุชุบูุฑ (ุชูุณูู ุงููุต ูุฌูู)
- `handleAssistantDelta()` - ูู ุชุชุบูุฑ
- `handleAssistantDone()` - ูู ุชุชุบูุฑ

**ุฏ) ุชุญุฏูุซ ุงูุชููุฆุฉ:**
```javascript
// ุงููุฏูู:
loadVoices();
window.speechSynthesis.onvoiceschanged = loadVoices;

// ุงูุฌุฏูุฏ:
const isRunning = await checkTTSServer();
```

#### ุงูุชุบููุฑุงุช ูู ุฏูุงู ุงููุนุงูุฌุฉ:
- [`handleAssistantText()`](bot_it/frontend/app.js:1000) - ุงูุขู ุชุณุชุฏุนู `speakText()` ุงูุฌุฏูุฏุฉ
- [`handleAssistantDelta()`](bot_it/frontend/app.js:438) - ุชุณุชุฎุฏู `enqueueUtterance()` ุงูุฌุฏูุฏุฉ

---

### 4๏ธโฃ ุฅูุดุงุก ููู [`start.bat`](bot_it/start.bat:1)

**ุงููุตู:** ุณูุฑุจุช Windows ูุชุดุบูู ุงูุฎุงุฏููู ูุนุงู

**ุงููููุฒุงุช:**
1. โ ูุญุต ูุฌูุฏ Python ู Node.js
2. โ ุชุซุจูุช ุงูููุชุจุงุช ุชููุงุฆูุงู ุฅุฐุง ูู ุชูู ููุฌูุฏุฉ
3. โ ุชุดุบูู ุฎุงุฏู TTS (Python) ุนูู ุงููููุฐ 5000
4. โ ุชุดุบูู ุฎุงุฏู WebSocket (Node.js) ุนูู ุงููููุฐ 3000
5. โ ูุชุญ ุงููุชุตูุญ ุชููุงุฆูุงู

**ุฎุทูุงุช ุงูุชูููุฐ:**
```batch
1. ูุญุต Python
2. ูุญุต Node.js
3. ุชุซุจูุช pip install -r requirements.txt
4. ุชุซุจูุช npm install (ุฅุฐุง ูุฒู ุงูุฃูุฑ)
5. ุชุดุบูู python backend\tts-server.py
6. ุชุดุบูู npm start
7. ูุชุญ http://localhost:3000
```

---

## ๐ ุชุฏูู ุงูุจูุงูุงุช ุงูุฌุฏูุฏ

### ูุจู ุงูุชุนุฏูู:
```
ุงููุณุชุฎุฏู โ ุงููููุฑูููู โ WebSocket โ Gemini AI
                                    โ
                            WebSocket โโ Browser (Web Speech Synthesis)
                                    โ
                            โ ูุดู ุงููุทู (ูุง ุฏุนู ููุนุฑุจูุฉ)
```

### ุจุนุฏ ุงูุชุนุฏูู:
```
ุงููุณุชุฎุฏู โ ุงููููุฑูููู โ WebSocket โ Gemini AI
                                    โ
                            WebSocket โโ Browser (Edge-TTS Client)
                                    โ
                            HTTP POST โโ Python TTS Server (Edge-TTS)
                                    โ
                            MP3 Audio (Base64)
                                    โ
                            ๐ ูุทู ุนุฑุจู ุนุงูู ุงูุฌูุฏุฉ
```

---

## ๐ ููุงุฑูุฉ ุงูุชูููุงุช

| ุงูููุฒุฉ | Web Speech Synthesis | Edge-TTS |
|--------|---------------------|----------|
| **ุฏุนู ุงูุนุฑุจูุฉ** | โ ูุง ูุชููุฑ ุนูู Windows | โ 10 ุฃุตูุงุช ุนุฑุจูุฉ |
| **ุงูุฌูุฏุฉ** | ูุชูุณุทุฉ (ุฅูุฌููุฒู ููุท) | ุนุงููุฉ ุฌุฏุงู (Neural) |
| **ุงูุชูููุฉ** | ูุฌุงูู | ูุฌุงูู 100% |
| **API Key** | ูุง ูุญุชุงุฌ | ูุง ูุญุชุงุฌ |
| **ุชุซุจูุช ุฃุตูุงุช** | ูุทููุจ ุนูู ุงููุธุงู | ุบูุฑ ูุทููุจ |
| **ุงููุฑููุฉ** | ูุญุฏูุฏ (ุฃุตูุงุช ุงููุชุตูุญ) | ุนุงูู (10 ุฃุตูุงุช ุนุฑุจูุฉ) |
| **ุงูุงุนุชูุงุฏูุฉ** | ูุชุบูุฑุฉ ุญุณุจ ุงููุชุตูุญ | ุซุงุจุชุฉ (Microsoft Edge) |

---

## ๐ ุฎุทูุงุช ุงูุชุดุบูู

### ุงูุทุฑููุฉ 1: ุงุณุชุฎุฏุงู start.bat (ููุตู ุจู)
```batch
cd bot_it
start.bat
```

### ุงูุทุฑููุฉ 2: ุชุดุบูู ูุฏูู
**Terminal 1 - ุฎุงุฏู TTS:**
```bash
cd bot_it
python backend/tts-server.py
```

**Terminal 2 - ุฎุงุฏู WebSocket:**
```bash
cd bot_it
npm start
```

**ุงููุชุตูุญ:**
```
ุงูุชุญ: http://localhost:3000
```

---

## ๐งช ุงูุงุฎุชุจุงุฑ

### ุงุฎุชุจุงุฑ ุงููุทู:
```javascript
// ูู Console ุงููุชุตูุญ
testArabicTTS()
```

### ูุญุต ุงูุฃุตูุงุช:
```javascript
// ูู Console ุงููุชุตูุญ
testVoices()
```

### ูุญุต ุงูุฎุงุฏู:
```javascript
// ูู Console ุงููุชุตูุญ
checkTTS()
```

### ุฃู ุนุจุฑ curl:
```bash
curl http://localhost:5000/health
curl http://localhost:5000/voices
```

---

## ๐ ุงูุฃุฏุงุก

### ููุงููุณ ุงูุฃุฏุงุก ุงููุชููุนุฉ:
- **ุฒูู ุงูุงุณุชุฌุงุจุฉ**: ~500ms - 2s (ุญุณุจ ุทูู ุงููุต)
- **ุฌูุฏุฉ ุงูุตูุช**: 16kHz - 24kHz MP3
- **ุฏุนู ุงููุชุฒุงููุฉ**: ูุนู (async/await)
- **ุงุณุชููุงู ุงูุฐุงูุฑุฉ**: ููุฎูุถ (~50MB ููุฎุงุฏู)

---

## โ๏ธ ุงูุชุฎุตูุต

### ุชุบููุฑ ุงูุตูุช ุงูุงูุชุฑุงุถู:
```python
# ูู backend/tts-server.py
DEFAULT_VOICE = 'ar-EG-SalmaNeural'  # ูุตุฑู - ุณููู
```

### ุชุบููุฑ ุงููููุฐ:
```python
# ูู backend/tts-server.py
PORT = 6000  # ุจุฏูุงู ูู 5000
```

```javascript
// ูู frontend/app.js
const TTS_SERVER = 'http://localhost:6000';
```

---

## ๐ ุงุณุชูุดุงู ุงูุฃุฎุทุงุก

### ุงููุดููุฉ: ุฎุงุฏู TTS ูุง ูุนูู
**ุงูุญู:**
```bash
# ุชุฃูุฏ ูู ุชุซุจูุช ุงูููุชุจุงุช
pip install -r requirements.txt

# ุชุฃูุฏ ูู ุชุดุบูู ุงูุฎุงุฏู
python backend/tts-server.py
```

### ุงููุดููุฉ: ูุง ููุฌุฏ ุตูุช
**ุงูุญู:**
1. ุงูุชุญ Console ุงููุชุตูุญ (F12)
2. ุชุญูู ูู ูุฌูุฏ ุฃุฎุทุงุก
3. ุชุฃูุฏ ูู ุฃู ุฎุงุฏู TTS ูุนูู: `checkTTS()`

### ุงููุดููุฉ: CORS Error
**ุงูุญู:** ุงูุฎุงุฏู ูุญุชูู ุนูู CORS middlewareุ ุชุฃูุฏ ูู ุชุดุบููู ุนูู ุงููููุฐ ุงูุตุญูุญ

---

## ๐ ููุงุญุธุงุช ูููุฉ

1. **ุงูุชุจุนูุงุช**: ูุชุทูุจ Python 3.7+ ู Node.js 14+
2. **ุงูุงุชุตุงู**: ูุฌุจ ุฃู ูููู ุฎุงุฏู TTS ูุนูู ูุจู ูุชุญ ุงููุชุตูุญ
3. **ุงูุฃุตูุงุช**: ูููู ุชุบููุฑ ุงูุตูุช ูู ุงูููุฏ ุฃู ุฅุถุงูุฉ ูุงุฌูุฉ ูุณุชุฎุฏู
4. **ุงูุฃูุงู**: ุงูุฎุงุฏู ูุณุชูุน ุนูู 0.0.0.0 (ุฌููุน ุงููุงุฌูุงุช)

---

## โ ูุงุฆูุฉ ุงูุชุญูู ุงูููุงุฆูุฉ

- [x] ุฅูุดุงุก requirements.txt
- [x] ุฅูุดุงุก backend/tts-server.py
- [x] ุชุนุฏูู frontend/app.js
- [x] ุฅูุดุงุก start.bat
- [x] ุชุซุจูุช ุงูููุชุจุงุช (ุฌุงุฑู)
- [x] ุงุฎุชุจุงุฑ ุงูุฎุงุฏู
- [x] ุชูุซูู ุงูููุฏ

---

## ๐ฏ ุงูุฎูุงุตุฉ

ุชู ุจูุฌุงุญ ุงุณุชุจุฏุงู Web Speech Synthesis API ุจูุธุงู Edge-TTS ุงููุชูุฏู. ุงููุธุงู ุงูุฌุฏูุฏ ูููุฑ:

1. **ุฏุนู ูุงูู ููุนุฑุจูุฉ** ูุน 10 ุฃุตูุงุช neural ุนุงููุฉ ุงูุฌูุฏุฉ
2. **ูุฌุงูู 100%** ุจุฏูู ุฃู ุชูุงููู ุฃู API Keys
3. **ุณูู ุงูุงุณุชุฎุฏุงู** ูุน ุณูุฑุจุช start.bat ููุชุดุบูู ุงูุณุฑูุน
4. **ูุงุจู ููุชุฎุตูุต** ููููู ุฅุถุงูุฉ ุงููุฒูุฏ ูู ุงูุฃุตูุงุช
5. **ูุณุชูุฑ** ูุน ูุนุงูุฌุฉ ุฃุฎุทุงุก ุดุงููุฉ

ุงูุฑูุจูุช ุฌุงูุฒ ุงูุขู ูููุทู ุจุงููุบุฉ ุงูุนุฑุจูุฉ ุจุทูุงูุฉ! ๐

---

**ุชู ุงูุฅูุดุงุก**: 2025-02-02  
**ุงูุฅุตุฏุงุฑ**: 1.0  
**ุงูุญุงูุฉ**: โ ููุชูู ูุฌุงูุฒ ููุงุณุชุฎุฏุงู
